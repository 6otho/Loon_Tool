#!name=Spotify歌词翻译（百度API·最终版）
#!desc=仅拦截“外部翻译”接口，用百度API翻译，不破坏原文歌词
#!author=6otho [https://github.com/6otho]
#!homepage=https://t.me/PaKo_Ov_Chan
#!icon=https://raw.githubusercontent.com/tugepaopao/Image-Storage/master/cartoon/Cute/spotify.png
#!loon_version=3.3+

[Argument]
appid = input, tag = 百度 AppID, desc = 此处填写百度翻译的 AppID
securityKey = input, tag = 百度 密钥, desc = 此处填写百度翻译的密钥

[Rule]
# 确保 QUIC 流量被拒绝，转用 HTTP 拦截
AND, ((DOMAIN-SUFFIX, spotify.com), (PROTOCOL, QUIC)), REJECT

[Script]
# —— 仅拦截 spclient.wg.spotify.com 的纯原文歌词接口（不含 subtype=External），用本地脚本替换 ——  
http-response ^https?:\/\/spclient\.wg\.spotify\.com\/color-lyrics\/v2\/track\/\w+(?!.*subtype=External) url script-response-body=https://raw.githubusercontent.com/xiaomaoJT/QxScript/main/rewrite/boxJS/source/sp.js, requires-body=true, binary-body-mode=true, timeout=10, tag=Spotify.歌词.本地

[MITM]
# 同时对 api.spotify.com 及 spclient.wg.spotify.com 开启 HTTPS 解密
hostname = api.spotify.com, *.spotify.com, spclient.wg.spotify.com
